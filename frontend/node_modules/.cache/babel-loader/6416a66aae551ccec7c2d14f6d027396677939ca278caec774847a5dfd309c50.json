{"ast":null,"code":"/**\n * Messages Slice - Mensajes directos\n * \n * INTEGRACIÓN NOSQL:\n * - MongoDB: Almacenar mensajes {sender, receiver, content, created_at, read}\n * - Neo4j: Relación (User)-[:MESSAGED]->(User) con timestamp\n * - Redis Cluster: Cache de conversaciones\n * \n * REDIS CLUSTER:\n * - {conv:alice::bob}:messages -> hash(\"conv:alice::bob\") -> slot -> Master\n * - Ordenar usernames alfabéticamente para consistencia\n * - TTL: 300 segundos (5 minutos)\n */\n\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { dmsAPI } from '../../services/api';\nconst initialState = {\n  conversations: [],\n  currentConversation: null,\n  messages: [],\n  loading: false,\n  error: null\n};\n\n/**\n * Fetch conversations\n * \n * Backend: GET /dm/conversations/{username}\n */\nexport const fetchConversations = createAsyncThunk('messages/fetchConversations', async (username, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await dmsAPI.listConversations(username);\n    return response.data;\n  } catch (error) {\n    var _error$response, _error$response$data;\n    return rejectWithValue(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || 'Error al cargar conversaciones');\n  }\n});\n\n/**\n * Fetch conversation\n * \n * Backend: GET /dm/{username}/{other}\n * \n * Flujo:\n * 1. Redis: GET {conv:alice::bob}:messages\n * 2. Si cache miss:\n *    a. MongoDB: Query messages\n *    b. Redis: SETEX {conv:alice::bob}:messages 300 [messages_json]\n * 3. Retornar\n */\nexport const fetchConversation = createAsyncThunk('messages/fetchConversation', async ({\n  username,\n  otherUsername\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await dmsAPI.getConversation(username, otherUsername);\n    return response.data;\n  } catch (error) {\n    var _error$response2, _error$response2$data;\n    return rejectWithValue(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.detail) || 'Error al cargar mensajes');\n  }\n});\n\n/**\n * Send message\n * \n * Backend: POST /dm/send\n * \n * Flujo:\n * 1. MongoDB: Insert message\n * 2. Neo4j: MERGE (u)-[:MESSAGED]->(other)\n * 3. Redis: DELETE {conv:alice::bob}:messages (invalidar)\n */\nexport const sendMessage = createAsyncThunk('messages/sendMessage', async (messageData, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await dmsAPI.sendDM(messageData);\n    return response.data;\n  } catch (error) {\n    var _error$response3, _error$response3$data;\n    return rejectWithValue(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.detail) || 'Error al enviar mensaje');\n  }\n});\nconst messagesSlice = createSlice({\n  name: 'messages',\n  initialState,\n  reducers: {\n    setCurrentConversation: (state, action) => {\n      state.currentConversation = action.payload;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchConversations.fulfilled, (state, action) => {\n      state.conversations = action.payload;\n    }).addCase(fetchConversation.pending, state => {\n      state.loading = true;\n    }).addCase(fetchConversation.fulfilled, (state, action) => {\n      state.loading = false;\n      state.messages = action.payload;\n    }).addCase(sendMessage.fulfilled, (state, action) => {\n      state.messages.push(action.payload);\n    });\n  }\n});\nexport const {\n  setCurrentConversation\n} = messagesSlice.actions;\nexport default messagesSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","dmsAPI","initialState","conversations","currentConversation","messages","loading","error","fetchConversations","username","rejectWithValue","response","listConversations","data","_error$response","_error$response$data","detail","fetchConversation","otherUsername","getConversation","_error$response2","_error$response2$data","sendMessage","messageData","sendDM","_error$response3","_error$response3$data","messagesSlice","name","reducers","setCurrentConversation","state","action","payload","extraReducers","builder","addCase","fulfilled","pending","push","actions","reducer"],"sources":["/unam/bdn/The_v2_Social_Service/The_Social_Service/frontend/src/features/messages/messagesSlice.js"],"sourcesContent":["/**\n * Messages Slice - Mensajes directos\n * \n * INTEGRACIÓN NOSQL:\n * - MongoDB: Almacenar mensajes {sender, receiver, content, created_at, read}\n * - Neo4j: Relación (User)-[:MESSAGED]->(User) con timestamp\n * - Redis Cluster: Cache de conversaciones\n * \n * REDIS CLUSTER:\n * - {conv:alice::bob}:messages -> hash(\"conv:alice::bob\") -> slot -> Master\n * - Ordenar usernames alfabéticamente para consistencia\n * - TTL: 300 segundos (5 minutos)\n */\n\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { dmsAPI } from '../../services/api';\n\nconst initialState = {\n  conversations: [],\n  currentConversation: null,\n  messages: [],\n  loading: false,\n  error: null,\n};\n\n/**\n * Fetch conversations\n * \n * Backend: GET /dm/conversations/{username}\n */\nexport const fetchConversations = createAsyncThunk(\n  'messages/fetchConversations',\n  async (username, { rejectWithValue }) => {\n    try {\n      const response = await dmsAPI.listConversations(username);\n      return response.data;\n    } catch (error) {\n      return rejectWithValue(error.response?.data?.detail || 'Error al cargar conversaciones');\n    }\n  }\n);\n\n/**\n * Fetch conversation\n * \n * Backend: GET /dm/{username}/{other}\n * \n * Flujo:\n * 1. Redis: GET {conv:alice::bob}:messages\n * 2. Si cache miss:\n *    a. MongoDB: Query messages\n *    b. Redis: SETEX {conv:alice::bob}:messages 300 [messages_json]\n * 3. Retornar\n */\nexport const fetchConversation = createAsyncThunk(\n  'messages/fetchConversation',\n  async ({ username, otherUsername }, { rejectWithValue }) => {\n    try {\n      const response = await dmsAPI.getConversation(username, otherUsername);\n      return response.data;\n    } catch (error) {\n      return rejectWithValue(error.response?.data?.detail || 'Error al cargar mensajes');\n    }\n  }\n);\n\n/**\n * Send message\n * \n * Backend: POST /dm/send\n * \n * Flujo:\n * 1. MongoDB: Insert message\n * 2. Neo4j: MERGE (u)-[:MESSAGED]->(other)\n * 3. Redis: DELETE {conv:alice::bob}:messages (invalidar)\n */\nexport const sendMessage = createAsyncThunk(\n  'messages/sendMessage',\n  async (messageData, { rejectWithValue }) => {\n    try {\n      const response = await dmsAPI.sendDM(messageData);\n      return response.data;\n    } catch (error) {\n      return rejectWithValue(error.response?.data?.detail || 'Error al enviar mensaje');\n    }\n  }\n);\n\nconst messagesSlice = createSlice({\n  name: 'messages',\n  initialState,\n  reducers: {\n    setCurrentConversation: (state, action) => {\n      state.currentConversation = action.payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(fetchConversations.fulfilled, (state, action) => {\n        state.conversations = action.payload;\n      })\n      .addCase(fetchConversation.pending, (state) => {\n        state.loading = true;\n      })\n      .addCase(fetchConversation.fulfilled, (state, action) => {\n        state.loading = false;\n        state.messages = action.payload;\n      })\n      .addCase(sendMessage.fulfilled, (state, action) => {\n        state.messages.push(action.payload);\n      });\n  },\n});\n\nexport const { setCurrentConversation } = messagesSlice.actions;\nexport default messagesSlice.reducer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}